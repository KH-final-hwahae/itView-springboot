<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="itView.springboot.mapper.AdminMapper">
<!-- 회원 전체 조회-->
<select id="getUserListCount" resultType="int">
select count(*) 
    from (
        select u.user_no, u.user_id, u.email, u.user_type, u.brand_name, u.user_status,
               count(r.report_no) as reportCount
        from "USER" u
        left join REPORT r on u.user_no = r.reporter_user_id
        group by u.user_no, u.user_id, u.email, u.user_type, u.brand_name, u.user_status)t
	<if test="value != null and value != ''">
		<choose>
			<when test="condition == 'userId'">
				where user_id like '%' || #{value} || '%'
			</when>
			<when test="condition == 'userType'">
				where user_type like '%'|| #{value} ||'%'
			</when>
			<when test="condition == 'userStatus'">
				where user_status like '%' || #{value} || '%'
			</when>
			<when test="condition == 'reportCount'">
				where reportCount = #{value}
			</when>
			<otherwise>
            	where (user_id like '%' || #{value} || '%')
            </otherwise>
		</choose>
	</if>
</select>

<select id="selectUserList" resultType="itView.springboot.dto.UserReport">
	select * 
    from (
        select u.user_no, u.user_id, u.email, u.user_type, u.brand_name, u.user_status,
               count(r.report_no) as reportCount
        from "USER" u
        left join REPORT r on u.user_no = r.reporter_user_id
        group by u.user_no, u.user_id, u.email, u.user_type, u.brand_name, u.user_status)t
	<if test="value != null and value != ''">
		<choose>
			<when test="condition == 'userId'">
				where upper(user_id) like '%' || upper(#{value}) || '%'
			</when>
			<when test="condition == 'userType'">
				where upper(user_type) like '%'|| upper(#{value})||'%'
			</when>
			<when test="condition == 'userStatus'">
				where upper(user_status) like '%' || upper(#{value}) || '%'
			</when>
			<when test="condition == 'reportCount'">
				where reportCount = #{value}
			</when>
			<otherwise>
            	where (upper(user_id) like '%' || upper(#{value}) || '%')
            </otherwise>
		</choose>
	</if>
</select>

<select id="selectUser" parameterType="int" resultType="itView.springboot.dto.UserReport">
	select * from "USER" where user_no = #{userNo}
</select>


<!-- 신고부분
	(1)신고회원리스트 조회 -->
<select id="getReportListCount" resultType="int">
select count(*) 
    from (
        select u.user_no, u.user_id, u.user_name, u.user_type,
        r.report_no, r.report_title, r.report_date, r.report_modify_Date,r.report_status,
        r.report_type, r.reporter_user_id, r.report_target_no
        from "USER" u
        left join REPORT r on u.user_no = r.reporter_user_id
        
	<if test="value != null and value != ''">
		<choose>
			<when test="condition == 'title'">
				where upper(report_title) like '%' || #{value} || '%'
			</when>
			<when test="condition == 'writer'">
				where upper(user_name) like '%'|| #{value} ||'%'
			</when>
			<when test="condition == 'reportType'">
				where upper(report_type) = #{value} 
			</when>
			<when test="condition == 'reportStatus'">
				where upper(report_status) = #{value}
			</when>
			<otherwise>
            	where (title like '%' || #{value} || '%')
            </otherwise>
		</choose>
	</if>
</select>

<select id="selectReportList" resultType="itView.springboot.dto.ReportDetail">
    SELECT u.user_no, u.user_id, u.user_name, u.user_type,
           r.report_no, r.report_title, r.report_date, r.report_modify_date,
           r.report_status, r.report_type, r.reporter_user_id, r.report_target_no
    FROM "USER" u
    LEFT JOIN REPORT r ON u.user_no = r.reporter_user_id
    <where>
        <if test="value != null and value != ''">
            <choose>
                <when test="condition == 'title'">
                    AND UPPER(r.report_title) LIKE '%' || UPPER(#{value}) || '%'
                </when>
                <when test="condition == 'userName'">
                    AND UPPER(u.user_name) LIKE '%' || UPPER(#{value}) || '%'
                </when>
                <when test="condition == 'reportType'">
                    AND UPPER(r.report_type) = UPPER(#{value})
                </when>
                <when test="condition == 'reportStatus'">
                    AND UPPER(r.report_status) = UPPER(#{value})
                </when>
            </choose>
        </if>
    </where>
    ORDER BY r.report_date DESC
</select>


<select id="selectReport" parameterType="int" resultType="itView.springboot.dto.ReportDetail">
	select * from report where report_no = #{reportNo}
</select>









</mapper>